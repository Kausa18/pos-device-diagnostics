<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diagnostic Dashboard</title>
    <style>
        :root {
            --primary: #1e88e5; --success: #28a745; --danger: #dc3545; --warning: #f9a825;
            --bg: #f0f2f5; --card-bg: #ffffff; --text: #2c3e50; --text-muted: #7f8c8d;
            --sidebar-bg: #1a2a3a; --sidebar-text: #bdc3c7; --sidebar-active: #ffffff;
        }
        body { font-family: 'Segoe UI', Roboto, Arial, sans-serif; margin: 0; background: var(--bg); display: flex; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; height: 100vh; position: fixed; }
        .sidebar-brand { padding: 20px; font-size: 24px; font-weight: 900; color: var(--sidebar-active); text-align: center; border-bottom: 1px solid #2c3e50; }
        .sidebar-nav-section { font-size: 12px; text-transform: uppercase; padding: 20px 20px 10px; font-weight: 700; color: #7f8c8d; }
        .sidebar-nav a { display: block; color: var(--sidebar-text); text-decoration: none; padding: 12px 20px; font-weight: 600; transition: 0.2s; border-left: 3px solid transparent; }
        .sidebar-nav a:hover { background: #2c3e50; color: var(--sidebar-active); }
        .sidebar-nav a.active { background: #2c3e50; color: var(--sidebar-active); border-left-color: var(--primary); }
        
        /* Main Content */
        .main-content { flex-grow: 1; margin-left: 260px; display: flex; flex-direction: column; }
        .header { background: var(--card-bg); padding: 12px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e0e0e0; position: sticky; top: 0; z-index: 100; }
        .btn-logout { background: transparent; border: 1px solid #ddd; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-logout:hover { background: #fee; color: #c00; border-color: #fcc; }
        
        main { padding: 20px; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }

        .kpi-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .kpi-card .title { font-size: 14px; font-weight: 600; color: var(--text-muted); margin-bottom: 10px; }
        .kpi-card .value { font-size: 32px; font-weight: 800; color: var(--text); }
        .kpi-card .value .unit { font-size: 16px; font-weight: 600; color: var(--text-muted); margin-left: 5px; }
        .kpi-card .value.critical { color: var(--danger); }

        .card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .card-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; }

        /* Chart Placeholders */
        .chart-placeholder { width: 100%; height: 250px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #ccc; font-weight: bold; }
        .pie-chart-container { width: 100%; display: flex; justify-content: center; align-items: center; gap: 20px; }
        .pie-chart { width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(var(--success) 0 65%, var(--warning) 65% 85%, var(--danger) 85% 100%); }
        .legend { list-style: none; padding: 0; }
        .legend li { display: flex; align-items: center; margin-bottom: 8px; }
        .legend .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }
        
        /* Activity Feed */
        .activity-feed { list-style: none; padding: 0; margin: 0; max-height: 250px; overflow-y: auto; }
        .activity-feed li { padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .activity-feed li:last-child { border: none; }
        .activity-feed .time { font-size: 12px; color: var(--text-muted); display: block; margin-top: 4px; }
        .activity-feed .highlight { color: var(--danger); font-weight: bold; }

        /* Data Table */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .data-table th { font-weight: 700; color: var(--text-muted); }
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-brand">Diagnostic Dashbord</div>
    <div class="sidebar-nav">
        <div class="sidebar-nav-section">Device Management</div>
        <a href="devices.html">Connected Devices</a>
        <a href="#">Test Logs</a>
        
        <div class="sidebar-nav-section">Analytics & Reports</div>
        <a href="#" class="active">Key Metrics</a>
        <a href="#">Diagnostic Trends</a>
        
        <div class="sidebar-nav-section">Admin</div>
        <a href="users.html" id="adminUsersLink">User Management</a>
    </div>
</div>

<div class="main-content">
    <div class="header">
        <div id="welcomeMessage" style="font-weight: 600;"></div>
        <button class="btn-logout" onclick="logout()">LOGOUT</button>
    </div>

    <main>
        <!-- KPI CARDS -->
        <div class="grid-container" style="margin-bottom: 20px;">
            <div class="kpi-card">
                <div class="title">Tests Today</div>
                <div class="value">14</div>
            </div>
            <div class="kpi-card">
                <div class="title">Critical Alerts</div>
                <div class="value critical">3</div>
            </div>
            <div class="kpi-card">
                <div class="title">Device Success Rate</div>
                <div class="value">99.4 <span class="unit">%</span></div>
            </div>
        </div>

        <div class="grid-container">
            <!-- Daily Tests Overview -->
            <div class="card" style="grid-column: span 2;">
                <div class="card-title">Daily Tests Overview</div>
                <div class="chart-placeholder">(Bar/Line Chart Placeholder)</div>
            </div>

            <!-- Result Distribution -->
            <div class="card">
                <div class="card-title">Result Distribution</div>
                <div class="pie-chart-container">
                    <div class="pie-chart"></div>
                    <ul class="legend">
                        <li><span class="dot" style="background:var(--success)"></span> Normal</li>
                        <li><span class="dot" style="background:var(--warning)"></span> Abnormal</li>
                        <li><span class="dot" style="background:var(--danger)"></span> Critical</li>
                    </ul>
                </div>
            </div>

            <!-- Device & Test Activity Feed -->
            <div class="card">
                <div class="card-title">Device & Test Activity</div>
                <ul class="activity-feed">
                    <li>QC Check <span class="highlight">Failed</span> on Hematology-1 <span class="time">Just now</span></li>
                    <li>Reagent low alert for Cartridge #A789 <span class="time">1 hour ago</span></li>
                    <li>Device #DX-4500 calibrated by "Dr. Lee" <span class="time">15 minutes ago</span></li>
                    <li>New test completed: Glucose <span class="highlight">142 mg/dL</span> <span class="time">2 minutes ago</span></li>
                </ul>
            </div>

            <!-- Most Performed Tests Table -->
            <div class="card" style="grid-column: span 2;">
                <div class="card-title">Most Performed Tests</div>
                <table class="data-table">
                    <thead><tr><th>Test Name</th><th>Volume</th><th>Positivity Rate</th><th>Status</th></tr></thead>
                    <tbody>
                        <tr><td>Hemoglobin A1c</td><td>88</td><td>4.5%</td><td><span class="status-dot" style="background:var(--success)"></span> In Stock</td></tr>
                        <tr><td>Rapid Strep</td><td>32</td><td>12.5%</td><td><span class="status-dot" style="background:var(--success)"></span> In Stock</td></tr>
                        <tr><td>Lipid Panel</td><td>22</td><td>8.1%</td><td><span class="status-dot" style="background:var(--warning)"></span> Low Reagent</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script>
    // Ensure session exists
    const userStr = sessionStorage.getItem('user');
    if (!userStr) {
        window.location.href = '/login.html';
    } else {
        const user = JSON.parse(userStr);
        document.getElementById('welcomeMessage').innerText = `Welcome, ${user.username}`;
        if (user.role !== 'admin') {
            document.getElementById('adminUsersLink').style.display = 'none';
        }
    }

    function logout() {
        sessionStorage.clear();
        window.location.href = '/login.html';
    }
</script>

</body>
</html>
